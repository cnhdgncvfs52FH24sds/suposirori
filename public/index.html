<!DOCTYPE html> 
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>PreviewHub ‚Äî Vista previa segura de 30s y descarga en PC</title>
  <meta name="description" content="PreviewHub: galer√≠a profesional para publicar videos con vista previa de 30 segundos. En m√≥viles se permite ver la demo; las descargas completas solo est√°n habilitadas en PC." />
  <meta name="theme-color" content="#0f1630" />
  <style>
    :root{
      --bg:#070912;--bg2:#0a0e1e;--card:#0f1630;--edge:#1e2647;--muted:#9fb0d7;--text:#eef3ff;
      --brand:#6a5cff;--brand-2:#00e0ff;--ok:#1bd96a;--warn:#ffcc00;--danger:#ff4d6d;
      --radius:22px;--shadow:0 18px 50px rgba(0,0,0,.45);
      --ring:#6a5cff;--ring2:#00e0ff;--pct:0;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;background:radial-gradient(1200px 800px at 20% -10%,#1a215000,#1a215080),
      linear-gradient(180deg,var(--bg),var(--bg2) 60%,#090c18);color:var(--text);
      font-family:Inter,ui-sans-serif,system-ui,Segoe UI,Roboto,Arial,sans-serif;overflow-x:hidden}
    @media (prefers-reduced-motion: reduce){*{animation:none!important;transition:none!important}}

    canvas#fx{position:fixed;inset:0;z-index:-1;opacity:.55}
    header{position:sticky;top:0;background:rgba(10,14,30,.6);backdrop-filter:saturate(1.4) blur(8px);
      border-bottom:1px solid rgba(255,255,255,.06);z-index:50}
    .wrap{max-width:1200px;margin:0 auto;padding:18px}

    .brand{display:flex;align-items:center;gap:14px}
    .logo{width:34px;height:34px;border-radius:10px;background:conic-gradient(from 210deg,var(--brand),var(--brand-2));
      box-shadow:0 6px 14px rgba(0,224,255,.25)}
    h1{margin:0;font-size:clamp(22px,3.2vw,34px);letter-spacing:.3px;display:flex;gap:10px;align-items:center}
    .pulse{display:inline-block;width:10px;height:10px;border-radius:50%;background:linear-gradient(135deg,var(--brand),var(--brand-2));
      box-shadow:0 0 0 0 rgba(0,224,255,.7);animation:pulse 2.2s infinite}
    @keyframes pulse{0%{box-shadow:0 0 0 0 rgba(0,224,255,.7)}70%{box-shadow:0 0 0 16px rgba(0,224,255,0)}100%{box-shadow:0 0 0 0 rgba(0,224,255,0)}}
    .sub{color:var(--muted);font-size:14px;margin-top:8px}

    .toolbar{display:flex;gap:12px;flex-wrap:wrap;margin-top:14px}
    .select, .button{border:1px solid rgba(255,255,255,.1);background:rgba(255,255,255,.04);color:var(--text);
      padding:10px 12px;border-radius:12px}
    .select{cursor:pointer}
    .button{cursor:pointer;transition:transform .08s ease, box-shadow .2s ease}
    .button:hover{transform:translateY(-1px)}
    .button.primary{background:linear-gradient(135deg,var(--brand),var(--brand-2));border-color:transparent;
      box-shadow:0 10px 22px rgba(0,224,255,.18)}

    .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:20px;margin:22px 0 54px}
    .card{background:linear-gradient(180deg,rgba(255,255,255,.05),rgba(255,255,255,.02));border:1px solid rgba(255,255,255,.1);
      border-radius:var(--radius);overflow:hidden;box-shadow:var(--shadow);position:relative;transform-style:preserve-3d;
      transition:transform .25s ease, box-shadow .25s ease;opacity:0;transform:translateY(10px) scale(.98)}
    .card.reveal{opacity:1;transform:translateY(0) scale(1)}
    .card:hover{transform:translateY(-4px) rotateX(1.2deg) rotateY(-1.2deg);box-shadow:0 22px 60px rgba(0,0,0,.55)}
    .card::after{content:"";position:absolute;inset:auto 0 0 0;height:3px;background:linear-gradient(90deg,var(--brand),var(--brand-2));opacity:.9;filter:blur(.3px)}

    .thumb{position:relative;aspect-ratio:16/9;background:#0b1226;display:grid;place-items:center;overflow:hidden}
    .thumb video{width:100%;height:100%;object-fit:cover;opacity:.8;pointer-events:none;filter:grayscale(.1) contrast(1.06)}
    .shine{position:absolute;inset:0;background:linear-gradient(110deg,transparent 0%,rgba(255,255,255,.07) 20%,transparent 40%);
      transform:translateX(-120%);transition:transform .8s ease}
    .card:hover .shine{transform:translateX(120%)}

    .pill{position:absolute;top:10px;left:10px;background:rgba(0,0,0,.55);border:1px solid rgba(255,255,255,.14);
      padding:6px 10px;border-radius:999px;font-size:12px;backdrop-filter:blur(3px)}
    .play{position:absolute;inset:0;display:grid;place-items:center}
    .play .ring{width:80px;height:80px;border-radius:999px;background:
      conic-gradient(from -90deg, var(--ring) calc(var(--pct)*1%), rgba(255,255,255,.1) 0);
      mask: radial-gradient(circle 34px at 50% 50%, transparent 97%, #000 100%);
      -webkit-mask: radial-gradient(circle 34px at 50% 50%, transparent 97%, #000 100%);
      display:grid;place-items:center;box-shadow:0 8px 26px rgba(0,0,0,.45);transition: background .2s linear}
    .play .core{width:68px;height:68px;border-radius:999px;background:radial-gradient(circle at 30% 30%,rgba(255,255,255,.18),rgba(255,255,255,.06));
      border:1px solid rgba(255,255,255,.18);display:grid;place-items:center}
    .play svg{transform:translateX(1px)}

    .card h3{margin:12px 14px 6px;font-size:17px}
    .card .meta{display:flex;justify-content:space-between;align-items:center;color:var(--muted);font-size:12px;padding:0 12px 14px}

    .modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,.65);
      backdrop-filter:blur(6px);z-index:100}
    .modal.show{display:flex;animation:fadeIn .18s ease}
    @keyframes fadeIn{from{opacity:0}to{opacity:1}}
    .player{width:min(94vw,1040px);background:var(--card);border:1px solid rgba(255,255,255,.1);border-radius:18px;box-shadow:var(--shadow);
      overflow:hidden;transform:scale(.96);animation:pop .18s .05s both}
    @keyframes pop{to{transform:scale(1)}}
    .player header{display:flex;align-items:center;justify-content:space-between;padding:12px 16px;border-bottom:1px solid rgba(255,255,255,.06);
      position:unset;background:transparent}
    .player h2{margin:0;font-size:18px}
    .player .close{border:none;background:#0000;color:var(--muted);font-size:22px;cursor:pointer}

    .stage{position:relative;background:#000}
    video#viewer{width:100%;height:auto;display:block;max-height:72vh}

    .overlay{position:absolute;inset:0;display:none;place-items:center;background:linear-gradient(180deg,rgba(0,0,0,.25),rgba(0,0,0,.8));
      text-align:center;padding:24px}
    .overlay.show{display:grid}
    .overlay .box{background:rgba(255,255,255,.04);border:1px solid rgba(255,255,255,.14);border-radius:18px;max-width:740px;padding:22px 18px;
      animation:lift .22s ease}
    @keyframes lift{from{transform:translateY(6px);opacity:.6}to{transform:translateY(0);opacity:1}}
    .overlay h3{margin:6px 0 10px;font-size:22px}
    .overlay p{margin:0 0 14px;color:#d8def5}
    .cta{display:flex;flex-wrap:wrap;gap:10px;justify-content:center}
    .cta a, .cta button{all:unset;display:inline-flex;align-items:center;gap:8px;padding:10px 14px;border-radius:12px;border:1px solid rgba(255,255,255,.15);cursor:pointer}
    .cta a.primary{background:linear-gradient(135deg,var(--brand),var(--brand-2));border-color:transparent}

    .timer{position:absolute;bottom:10px;right:10px;background:rgba(0,0,0,.55);border:1px solid rgba(255,255,255,.16);padding:6px 10px;border-radius:10px;font-size:12px}
    .warn{display:none;margin-top:10px;padding:10px 12px;border-radius:10px;background:rgba(255,204,0,.12);border:1px solid rgba(255,204,0,.35);
      color:#fff;text-align:center;font-size:13px}
    .warn.show{display:block;animation:blink .5s ease}
    @keyframes blink{from{opacity:.2}to{opacity:1}}

    footer{color:var(--muted);text-align:center;padding:30px 10px;font-size:13px;border-top:1px solid rgba(255,255,255,.06)}
  </style>
</head>
<body>
  <canvas id="fx"></canvas>

  <header>
    <div class="wrap">
      <div class="brand">
        <div class="logo" aria-hidden="true"></div>
        <div>
          <h1>PreviewHub <span class="pulse" aria-hidden="true"></span></h1>
          <div class="sub">Vista previa de 30s para todos. Descarga completa habilitada solo en PC.</div>
        </div>
      </div>
      <div class="toolbar" role="region" aria-label="Opciones de cat√°logo">
        <select id="themeSelect" class="select" title="Tema">
          <option value="default">Tema: Aurora</option>
          <option value="ocean">Tema: Ocean</option>
          <option value="crimson">Tema: Crimson</option>
        </select>
        <button id="aboutBtn" class="button">‚ÑπÔ∏è Acerca de</button>
      </div>
    </div>
  </header>

  <main class="wrap">
    <section class="grid" id="grid" aria-live="polite"></section>
  </main>

  <div class="modal" id="modal" aria-modal="true" role="dialog" aria-labelledby="playerTitle">
    <div class="player">
      <header>
        <h2 id="playerTitle">T√≠tulo</h2>
        <button class="close" id="closeBtn" title="Cerrar">‚úñ</button>
      </header>
      <div class="stage">
        <video id="viewer" controls playsinline></video>
        <div class="timer" id="timer">00:30</div>
        <div class="overlay" id="overlay">
          <div class="box">
            <h3>‚è±Ô∏è ¬°Vista previa finalizada!</h3>
            <p>Para ver el <strong>video completo</strong>, desc√°rgalo a tu dispositivo.</p>
            <div class="cta">
              <a id="downloadBtn" class="primary">‚¨áÔ∏è Descargar video completo</a>
              <button id="replayBtn">üîÑ Ver otra vez 30s</button>
            </div>
            <div id="mobileWarn" class="warn">‚ö†Ô∏è Las descargas est√°n permitidas solo desde computadoras (PC/Mac). En m√≥viles iOS/Android pod√©s ver la vista previa de 30s.</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <footer>
    ¬© <span id="year"></span> PreviewHub ¬∑ Un reproductor de vista previa de 30s con pol√≠tica de descarga segura.
  </footer>

<script>
  const PREVIEW_SECONDS = 30;
  const FULL_ZIP_ENDPOINT = '/api/download/fullzip';

  // Detecci√≥n dispositivo
  const ua = navigator.userAgent || navigator.vendor || window.opera || '';
  const isAndroid = /Android/i.test(ua);
  const isIOS = /iPhone|iPad|iPod/i.test(ua);
  const DEVICE = isAndroid ? 'android' : isIOS ? 'ios' : 'desktop';

  // Cat√°logo
  const localVideos = [
    { title: 'eloisa grabada', file: 'eloisa.mp4' },
    { title: 'senadora masista grabada', file: 'senadora.mp4' },
    { title: 'Anabel y marco antelo camara oculta', file: 'V√≠deo sin t√≠tulo ‚Äê Hecho con Clipchamp_1.mp4' },
  ];

  // Refs
  const grid = document.getElementById('grid');
  const modal = document.getElementById('modal');
  const viewer = document.getElementById('viewer');
  const overlay = document.getElementById('overlay');
  const timerEl = document.getElementById('timer');
  const downloadBtn = document.getElementById('downloadBtn');
  const replayBtn = document.getElementById('replayBtn');
  const closeBtn = document.getElementById('closeBtn');
  const playerTitle = document.getElementById('playerTitle');
  const mobileWarn = document.getElementById('mobileWarn');
  const themeSelect = document.getElementById('themeSelect');
  const aboutBtn = document.getElementById('aboutBtn');

  let guardSeek = false;

  // Utils
  function fmtTime(s){ s = Math.max(0, Math.ceil(s)); return String(Math.floor(s/60)).padStart(2,'0')+":"+String(s%60).padStart(2,'0'); }
  function fileUrl(name){ try{ return new URL(encodeURI(name), location.href).href; }catch{ return name; } }
  function clampPreview(){
    if(viewer.currentTime > PREVIEW_SECONDS){
      guardSeek = true; viewer.currentTime = PREVIEW_SECONDS - 0.05; guardSeek = false;
      viewer.pause(); overlay.classList.add('show');
    }
  }
  function updateCountdown(){
    const remain = PREVIEW_SECONDS - viewer.currentTime;
    timerEl.textContent = fmtTime(remain);
    document.documentElement.style.setProperty('--pct', Math.min(100, (viewer.currentTime/PREVIEW_SECONDS)*100));
  }

  // ‚ö†Ô∏è Aqu√≠ va la l√≥gica con ALERTA en m√≥viles
  function configureDownload(){
    if(DEVICE === 'desktop'){
      downloadBtn.setAttribute('href', FULL_ZIP_ENDPOINT);
      downloadBtn.setAttribute('download', 'anabel_y_marco_completo.zip');
      mobileWarn.classList.remove('show');
      downloadBtn.onclick = null;
    } else {
      downloadBtn.removeAttribute('href');
      downloadBtn.removeAttribute('download');
      mobileWarn.classList.add('show');
      downloadBtn.onclick = (e)=>{
        e.preventDefault();
        // parpadeo visual del aviso + ALERTA real
        mobileWarn.style.animation='none'; void mobileWarn.offsetWidth; mobileWarn.style.animation='blink .5s ease';
        alert('Solo se puede descargar el video completo en PC o computadora. En tu dispositivo m√≥vil puedes ver la vista previa de 30 segundos.');
      };
    }
  }

  function openPlayer(title, src){
    playerTitle.textContent = title || 'Video';
    viewer.src = src; viewer.currentTime = 0; viewer.play().catch(()=>{});
    overlay.classList.remove('show'); updateCountdown(); configureDownload();
    modal.classList.add('show');
  }
  function closePlayer(){
    viewer.pause(); viewer.removeAttribute('src'); viewer.load(); modal.classList.remove('show');
  }

  viewer.addEventListener('timeupdate', ()=>{ updateCountdown(); clampPreview(); });
  viewer.addEventListener('seeking', ()=>{
    if(guardSeek) return;
    if(viewer.currentTime > PREVIEW_SECONDS - 0.05){
      guardSeek = true; viewer.currentTime = PREVIEW_SECONDS - 0.05; guardSeek = false;
      viewer.pause(); overlay.classList.add('show');
    }
  });
  replayBtn.addEventListener('click', ()=>{ overlay.classList.remove('show'); viewer.currentTime = 0; viewer.play().catch(()=>{}); });
  closeBtn.addEventListener('click', closePlayer);
  modal.addEventListener('click', (e)=>{ if(e.target === modal) closePlayer(); });
  document.addEventListener('keydown', (e)=>{ if(e.key === 'Escape' && modal.classList.contains('show')) closePlayer(); });

  function cardTemplate(item){
    const el = document.createElement('article'); el.className = 'card'; const src = fileUrl(item.file);
    el.innerHTML = `
      <div class="thumb">
        <div class="pill">Vista previa 30s</div>
        <div class="shine"></div>
        <div class="play" aria-hidden="true">
          <div class="ring"><div class="core">
            <svg width="36" height="36" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M8 5v14l11-7L8 5z" stroke="#fff" stroke-opacity=".95" stroke-width="1.4"/>
            </svg>
          </div></div>
        </div>
        <video muted preload="metadata" src="${src}"></video>
      </div>
      <h3>${item.title || 'Video'}</h3>
      <div class="meta"><span>Archivo local</span><button class="button primary" data-play>‚ñ∂Ô∏è Ver 30s</button></div>
    `;
    el.querySelector('[data-play]').addEventListener('click', ()=> openPlayer(item.title, src));
    return el;
  }
  function renderGallery(list){
    grid.innerHTML = '';
    list.forEach(v => grid.appendChild(cardTemplate(v)));
    const io = new IntersectionObserver((entries)=>{
      entries.forEach(e=>{ if(e.isIntersecting){ e.target.classList.add('reveal'); io.unobserve(e.target);} });
    },{threshold:.12});
    document.querySelectorAll('.card').forEach(c=>io.observe(c));
  }
  renderGallery(localVideos);

  // Fondo animado simple
  const cvs = document.getElementById('fx'); const ctx = cvs.getContext('2d');
  let W,H,parts=[]; const N=70;
  function resize(){ W= cvs.width = innerWidth; H= cvs.height = innerHeight; }
  addEventListener('resize', resize); resize();
  function rnd(a,b){ return a+Math.random()*(b-a); }
  for(let i=0;i<N;i++) parts.push({x:rnd(0,W),y:rnd(0,H),vx:rnd(-.15,.15),vy:rnd(-.15,.15),r:rnd(0.6,1.8)});
  (function tick(){ ctx.clearRect(0,0,W,H); ctx.fillStyle='rgba(255,255,255,.08)';
    for(const p of parts){ p.x+=p.vx; p.y+=p.vy; if(p.x<0||p.x>W) p.vx*=-1; if(p.y<0||p.y>H) p.vy*=-1;
      ctx.beginPath(); ctx.arc(p.x,p.y,p.r,0,Math.PI*2); ctx.fill(); }
    requestAnimationFrame(tick);
  })();

  const themes = {
    default: {brand:'#6a5cff', brand2:'#00e0ff'},
    ocean:   {brand:'#00b3ff', brand2:'#00ffa6'},
    crimson: {brand:'#ff416c', brand2:'#ffb347'},
  };
  themeSelect.addEventListener('change', ()=>{
    const t = themes[themeSelect.value] || themes.default;
    document.documentElement.style.setProperty('--brand', t.brand);
    document.documentElement.style.setProperty('--brand-2', t.brand2);
    document.documentElement.style.setProperty('--ring', t.brand);
    document.documentElement.style.setProperty('--ring2', t.brand2);
  });
  aboutBtn.addEventListener('click', ()=>{
    alert('PreviewHub\n\n‚Ä¢ Reproduce 30s como demo.\n‚Ä¢ Descarga completa solo en PC.\n‚Ä¢ El ZIP final es el archivo completo.\n\nSugerencia: Diviertase todo lo que pueda');
  });

  document.getElementById('year').textContent = new Date().getFullYear();
</script>
</body>
</html>
